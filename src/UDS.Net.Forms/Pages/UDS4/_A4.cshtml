@model A4Model
@{
    string rowCSS = "sm:grid sm:grid-cols-3 sm:items-start sm:gap-4 sm:py-6";
    string checkboxCSS = "h-4 w-4 rounded border-gray-400 text-indigo-600 focus:ring-indigo-600 disabled:bg-slate-50 disabled:text-slate-500 disabled:border-slate-200 disabled:shadow-none";

    int popularMedsMedian = (int)Math.Ceiling((double)Model.PopularDrugCodes.Count / 2);
    int otcMedsMedian = (int)Math.Ceiling((double)Model.OTCDrugCodes.Count / 2);
    int customMedsMedian = (int)Math.Ceiling((double)Model.CustomDrugCodes.Count / 2);
}
<turbo-frame id="_A4">

    <div class="mt-10 space-y-8 border-b border-gray-900/10 pb-12 sm:space-y-0 sm:divide-y sm:divide-gray-900/10 sm:border-t sm:pb-0">
        <div class="sm:grid sm:grid-cols-3 sm:items-start sm:gap-4 sm:py-6">
            <label asp-for="A4.ANYMEDS"><span class="counter"></span> @Html.DisplayNameFor(m => m.A4.ANYMEDS)</label>
            <div class="mt-4 sm:mt-0">
                <p class="text-sm text-gray-500" asp-description-for="@Model.A4.ANYMEDS"></p>
                <radio-button-group id="@Html.IdFor(m => m.A4.ANYMEDS)" for="@Model.A4.ANYMEDS" items="Model.MedicationsWithinLastTwoWeeksListItems"></radio-button-group>
                <span class="mt-2 text-sm text-red-600" asp-validation-for="A4.ANYMEDS"></span>
            </div>
            <div>
                <turbo-frame id="_RxNormSearch">
                    <div data-controller="autocomplete formlessSubmit rxNormDisplayNames" data-action="autocomplete:newSearch->rxNormDisplayNames#fetchData" data-rxNormDisplayNames-fetchedLetters-value="" data-formlessSubmit-url-value="../A4/@Model.Visit.Id?handler=RxNormSearch">
                        <label class="max-w-xl text-3xl font-semibold tracking-tight text-balance text-gray-900 sm:text-4xl lg:col-span-7">Search RxNorm</label>
                        <div class="w-full max-w-md lg:col-span-5 lg:pt-2">
                            <div class="flex gap-x-4">
                                <label asp-for="@Model.RxNormLookup.SearchTerm" class="sr-only">@Html.DisplayNameFor(m => m.RxNormLookup.SearchTerm)</label>
                                <input data-autocomplete-target="searchBox" data-formlessSubmit-target="input" data-action="click->autocomplete#showList input->autocomplete#filterList" asp-for="@Model.RxNormLookup.SearchTerm" placeholder="Search by drug or brand name" class="min-w-0 flex-auto rounded-md bg-white px-3.5 py-2 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-1 focus:-outline-offset-1 focus:outline-indigo-600 sm:text-sm/6" />
                                <input type="hidden" asp-for="@Model.RxNormLookup.Id" />

                                <input data-action="click->formlessSubmit#submit" type="button" value="Search" class="flex-none rounded-md bg-indigo-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" />
                            </div>
                            <!--// Autocomplete //-->
                            <div data-autocomplete-target="list" class="mx-auto max-w-xl transform rounded-xl bg-white p-2 ring-1 shadow-2xl ring-black/5 transition-all">
                                <ul data-rxNormDisplayNames-target="list" class="-mb-2 max-h-72 scroll-py-2 overflow-y-auto py-2 text-sm text-gray-800" id="options" role="listbox">
                                    <!-- Active: "bg-indigo-600 text-white outline-hidden" -->
                                    <li data-autocomplete-target="item" class="cursor-default text-gray-900 rounded-md px-4 py-2 select-none" id="option-1" role="option" tabindex="-1">Search for medications by drug or brand name</li>
                                </ul>
                            </div>
                            <!--// No results //-->
                            <div data-autocomplete-target="noResults" class="bg-slate-50 px-16 py-20 text-center hidden">
                                <h2 class="font-semibold text-slate-900">No results found</h2>
                                <p class="mt-2 text-sm/6 text-slate-600">We can’t find anything with that term at the moment, try searching something else.</p>
                            </div>
                        </div>
                    </div>
                </turbo-frame>
            </div>
        </div>

        <!-- Checkboxes for popular, otc, and custom drug codes-->
        <div>
            <!-- Popular Drug Codes -->
            <div class="grid lg:grid-cols-2 sm:grid-cols-1">
                <!-- Left Column Popular Drug Codes -->
                <div class="sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.PopularDrugCodes != null && Model.PopularDrugCodes.Count() > 0)
                    {
                        for (int i = 0; i < popularMedsMedian; i++)
                        {
                            var drugCode = Model.PopularDrugCodes[i];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                                displayName += " (" + drugCode.BrandName + ")";
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="PopularDrugCodes[i].Id" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].RxNormId" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].DrugName" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].BrandName" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].IsOverTheCounter" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].IsPopular" type="hidden" />
                                                <input asp-for="PopularDrugCodes[i].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.PopularDrugCodes[i].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.PopularDrugCodes[i].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>

                <!-- Right Column Popular Drug Codes -->
                <div class="flex flex-col sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.PopularDrugCodes != null && Model.PopularDrugCodes.Count() > 0)
                    {
                        for (int j = popularMedsMedian; j < Model.PopularDrugCodes.Count; j++)
                        {
                            var drugCode = Model.PopularDrugCodes[j];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                            {
                                displayName += " (" + drugCode.BrandName + ")";
                            }
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="PopularDrugCodes[j].Id" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].RxNormId" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].DrugName" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].BrandName" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].IsOverTheCounter" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].IsPopular" type="hidden" />
                                                <input asp-for="PopularDrugCodes[j].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.PopularDrugCodes[j].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.PopularDrugCodes[j].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>
            </div>

            @if (Model.OTCDrugCodes != null || Model.OTCDrugCodes.Count() == 0)
            {
                <div class="flex flex-col sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    <p>Commonly reported medications that may be purchased over the counter (but that may also be prescription)</p>
                </div>
            }

            <!-- OTC Drug Codes -->
            <div class="grid lg:grid-cols-2 sm:grid-cols-2">
                <!-- Left Column OTC Drug Codes -->
                <div class="sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.OTCDrugCodes != null && Model.OTCDrugCodes.Count() > 0)
                    {
                        for (int i = 0; i < otcMedsMedian; i++)
                        {
                            var drugCode = Model.OTCDrugCodes[i];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                            {
                                displayName += " (" + drugCode.BrandName + ")";
                            }
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="OTCDrugCodes[i].Id" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].RxNormId" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].DrugName" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].BrandName" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].IsOverTheCounter" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].IsPopular" type="hidden" />
                                                <input asp-for="OTCDrugCodes[i].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.OTCDrugCodes[i].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.OTCDrugCodes[i].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>

                <!-- Right Column OTC Drug Codes -->
                <div class="flex flex-col sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.OTCDrugCodes != null && Model.OTCDrugCodes.Count() > 0)
                    {
                        for (int j = otcMedsMedian; j < Model.OTCDrugCodes.Count; j++)
                        {
                            var drugCode = Model.OTCDrugCodes[j];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                            {
                                displayName += " (" + drugCode.BrandName + ")";
                            }
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="OTCDrugCodes[j].Id" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].RxNormId" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].DrugName" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].BrandName" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].IsOverTheCounter" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].IsPopular" type="hidden" />
                                                <input asp-for="OTCDrugCodes[j].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.OTCDrugCodes[j].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.OTCDrugCodes[j].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>
            </div>

            <div class="flex flex-col sm:grid sm:grid-cols-2 sm:items-start sm:gap-4 sm:py-6">
                <p>Custom medications</p>
                <div class="flex flex-col sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    <div>
                        <p><strong>If a medication is not listed</strong></p>
                        <p>Use the "Add" button to search for a valid RXNorm code by drug or brand name.</p>
                    </div>
                    <div>
                        <input type="submit" name="addCustomMed" value="Add" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600" />
                    </div>
                </div>
            </div>

            <!-- Custom Drug Codes -->
            <div class="grid lg:grid-cols-2 sm:grid-cols-2">
                <!-- Left  Column Custom Drug Codes -->
                <div class="sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.CustomDrugCodes != null && Model.CustomDrugCodes.Count() > 0)
                    {
                        for (int i = 0; i < customMedsMedian; i++)
                        {
                            var drugCode = Model.CustomDrugCodes[i];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                            {
                                displayName += " (" + drugCode.BrandName + ")";
                            }
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="CustomDrugCodes[i].Id" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].RxNormId" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].DrugName" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].BrandName" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].IsOverTheCounter" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].IsPopular" type="hidden" />
                                                <input asp-for="CustomDrugCodes[i].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.CustomDrugCodes[i].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.CustomDrugCodes[i].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>

                <!-- Right  Column Custom Drug Codes -->
                <div class="flex flex-col sm:grid sm:grid-cols-1 sm:items-start sm:gap-4 sm:py-6">
                    @if (Model.CustomDrugCodes != null && Model.CustomDrugCodes.Count() > 0)
                    {
                        for (int j = customMedsMedian; j < Model.CustomDrugCodes.Count; j++)
                        {
                            var drugCode = Model.CustomDrugCodes[j];
                            var displayName = drugCode.DrugName;

                            if (!string.IsNullOrWhiteSpace(drugCode.BrandName))
                            {
                                displayName += " (" + drugCode.BrandName + ")";
                            }
                            <div>
                                <fieldset>
                                    <div class="space-y-5">
                                        <div class="relative flex items-start">
                                            <span class="mr-3 block text-sm font-medium leading-6 text-gray-900"></span>
                                            <div class="flex h-6 items-center">
                                                <input asp-for="CustomDrugCodes[j].Id" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].RxNormId" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].DrugName" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].BrandName" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].IsOverTheCounter" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].IsPopular" type="hidden" />
                                                <input asp-for="CustomDrugCodes[j].IsSelected" type="checkbox" class="@checkboxCSS" />
                                            </div>
                                            <div class="ml-3 text-sm leading-6">
                                                <label for="@Html.IdFor(m => m.CustomDrugCodes[j].IsSelected)" class="font-medium text-gray-900">@displayName <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">@Model.CustomDrugCodes[j].RxNormId</span></label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        }
                    }
                </div>
            </div>

        </div>
    </div>

</turbo-frame>

